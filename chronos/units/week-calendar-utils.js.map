{"version":3,"sources":["../../../.tmp/chronos/units/week-calendar-utils.ts"],"names":[],"mappings":"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","file":"week-calendar-utils.js","sourceRoot":"","sourcesContent":["/**\r\n *\r\n * @param {number} year\r\n * @param {number} dow - start-of-first-week\r\n * @param {number} doy - start-of-year\r\n * @returns {number}\r\n */\r\nimport { createUTCDate } from '../create/date-from-array';\r\nimport { daysInYear } from './year';\r\nimport { getDayOfYear } from './day-of-year';\r\nimport { getFullYear } from '../utils/date-getters';\r\n\r\nfunction firstWeekOffset(year: number, dow: number, doy: number): number {\r\n  // first-week day -- which january is always in the first week (4 for iso, 1 for other)\r\n  const fwd = dow - doy + 7;\r\n  // first-week day local weekday -- which local weekday is fwd\r\n  const fwdlw = (createUTCDate(year, 0, fwd).getUTCDay() - dow + 7) % 7;\r\n\r\n  return -fwdlw + fwd - 1;\r\n}\r\n\r\n// https://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday\r\nexport function dayOfYearFromWeeks(\r\n  year: number,\r\n  week: number,\r\n  weekday: number,\r\n  dow: number,\r\n  doy: number\r\n): { year: number; dayOfYear: number } {\r\n  const localWeekday = (7 + weekday - dow) % 7;\r\n  const weekOffset = firstWeekOffset(year, dow, doy);\r\n  const dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset;\r\n  let resYear: number;\r\n  let resDayOfYear: number;\r\n\r\n  if (dayOfYear <= 0) {\r\n    resYear = year - 1;\r\n    resDayOfYear = daysInYear(resYear) + dayOfYear;\r\n  } else if (dayOfYear > daysInYear(year)) {\r\n    resYear = year + 1;\r\n    resDayOfYear = dayOfYear - daysInYear(year);\r\n  } else {\r\n    resYear = year;\r\n    resDayOfYear = dayOfYear;\r\n  }\r\n\r\n  return {\r\n    year: resYear,\r\n    dayOfYear: resDayOfYear\r\n  };\r\n}\r\n\r\nexport function weekOfYear(\r\n  date: Date,\r\n  dow: number,\r\n  doy: number\r\n): { week: number; year: number } {\r\n  const weekOffset = firstWeekOffset(getFullYear(date), dow, doy);\r\n  const week = Math.floor((getDayOfYear(date) - weekOffset - 1) / 7) + 1;\r\n  let resWeek: number;\r\n  let resYear: number;\r\n\r\n  if (week < 1) {\r\n    resYear = getFullYear(date) - 1;\r\n    resWeek = week + weeksInYear(resYear, dow, doy);\r\n  } else if (week > weeksInYear(getFullYear(date), dow, doy)) {\r\n    resWeek = week - weeksInYear(getFullYear(date), dow, doy);\r\n    resYear = getFullYear(date) + 1;\r\n  } else {\r\n    resYear = getFullYear(date);\r\n    resWeek = week;\r\n  }\r\n\r\n  return {\r\n    week: resWeek,\r\n    year: resYear\r\n  };\r\n}\r\n\r\nexport function weeksInYear(year: number, dow: number, doy: number): number {\r\n  const weekOffset = firstWeekOffset(year, dow, doy);\r\n  const weekOffsetNext = firstWeekOffset(year + 1, dow, doy);\r\n\r\n  return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;\r\n}\r\n"]}